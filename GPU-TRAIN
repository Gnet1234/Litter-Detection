import torch
from ultralytics import YOLO

# Check if GPU is available and set the device
if torch.cuda.is_available():
    gpu_number = 0  # Replace with your GPU number if it's different
    device = torch.device(f"cuda:{gpu_number}")
    print(f"Using GPU: {torch.cuda.get_device_name(gpu_number)}")
else:
    device = torch.device("cpu")
    print("CUDA is not available. Using CPU")

# Initialize YOLO model
model = YOLO("yolov8n.pt")

# Move model to the GPU if available
model.to(device)

# Train the model (YOLO's train method should handle device internally)
results = model.train(data=r'C:\Users\garne\anaconda3\envs\TensorFlowObjectDetection\TensorFlow\Car Dataset Yolov5\data.yaml', epochs=1, optimizer='Adam', plots=True, patience=2)

# Print the custom model class
print("Custom model class:", model.model)

# Save the trained model's state dictionary
save_path = r'C:\Users\garne\anaconda3\envs\TensorFlowObjectDetection\TensorFlow\models\yolov5_car.pt'
model.save(save_path)
